{% extends 'base.html' %}
{% block title %}Incident #{{ incident.id }}{% endblock %}

{% block content %}
<div class="row">
  <div class="col s12">
    <h4>Incident #{{ incident.id }}</h4>

    <div class="card">
      <div class="card-content">

        <!-- Malicious URL -->
        <div class="row">
          <div class="col s12">
            <p><strong>Malicious URL:</strong></p>
            <p>
              <a href="{{ incident.malicious_url }}" target="_blank" class="blue-text">
                {{ incident.malicious_url }}
              </a>
            </p>
          </div>
        </div>

        <!-- Severity & Status -->
        <div class="row">
          <div class="col s12 m6">
            <p>
              <strong>Severity:</strong>
              <span class="badge white-text
                {% if incident.severity == 'CRITICAL' %}red
                {% elif incident.severity == 'HIGH' %}orange
                {% elif incident.severity == 'MEDIUM' %}amber
                {% else %}green{% endif %}">
                {{ incident.get_severity_display }}
              </span>
            </p>
          </div>

          <div class="col s12 m6">
            <p>
              <strong>Status:</strong>
              {% if incident.is_active %}
                <span class="badge green white-text">Active</span>
              {% else %}
                <span class="badge grey darken-1 white-text">Inactive</span>
              {% endif %}
            </p>
          </div>
        </div>

        <!-- HTTP Response -->
        <div class="row">
          <div class="col s12">
            <p><strong>HTTP Response:</strong></p>
            <pre style="
              background: #f5f5f5;
              padding: 10px;
              border-radius: 4px;
              overflow-x: auto;
            ">{{ incident.http_response }}</pre>
          </div>
        </div>

        <!-- Description -->
        <div class="row">
          <div class="col s12">
            <p><strong>Description:</strong></p>
            <p>{{ incident.description }}</p>
          </div>
        </div>

        <!-- Screenshot -->
        {% if incident.screenshot %}
        <div class="row">
          <div class="col s12">
            <p><strong>Screenshot:</strong></p>
            <img
              src="{{ incident.screenshot.url }}"
              alt="Incident Screenshot"
              class="responsive-img materialboxed"
              style="
                max-width: 100%;
                border: 1px solid #ddd;
                border-radius: 4px;
              "
            />
          </div>
        </div>
        {% endif %}

        <!-- Meta info -->
        <div class="row">
          <div class="col s12 m6">
            <p><strong>Created By:</strong> {{ incident.created_by.username }}</p>
          </div>
          <div class="col s12 m6">
            <p><strong>Created At:</strong> {{ incident.created_at|date:"M d, Y H:i" }}</p>
          </div>
        </div>

        {% if incident.updated_at %}
        <div class="row">
          <div class="col s12">
            <p><strong>Last Updated:</strong> {{ incident.updated_at|date:"M d, Y H:i" }}</p>
          </div>
        </div>
        {% endif %}
      </div>

      <!-- Actions -->
      <div class="card-action">
        <a href="{% url 'incident_list' %}" class="btn blue darken-2">Back to List</a>

        {% if user.is_superuser %}
          <a href="{% url 'incident_update' incident.pk %}" class="btn orange">Edit</a>
          <a href="{% url 'incident_delete' incident.pk %}" class="btn red">Delete</a>
        {% endif %}
      </div>
    </div>
  </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
  document.addEventListener("DOMContentLoaded", function () {
    var elems = document.querySelectorAll(".materialboxed");
    M.Materialbox.init(elems);
  });
</script>
{% endblock %}
